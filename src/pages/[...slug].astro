---
import BaseLayout from '../layouts/BaseLayout.astro';
import DocsLayout from '../layouts/DocsLayout.astro';
import { getCollection, getEntry, render } from 'astro:content';

export async function getStaticPaths() {
  const allDocs = await getCollection('docs'); 
  
  return allDocs.map((doc) => ({
    params: { slug: doc.id },
  }));
}

const { slug } = Astro.params;

const currentDoc = await getEntry('docs', slug || 'index');

if (!currentDoc) {
  return Astro.redirect('/404');
}

const allDocsEntries = await getCollection('docs');

const allDocs = allDocsEntries.map((entry) => ({
  slug: entry.id,
  title: entry.data.title ?? entry.id, 
}));

const { Content } = await render(currentDoc);
---

<BaseLayout>
  <DocsLayout
    items={allDocs}
    currentSlug={currentDoc.id}
    title={currentDoc.data.title ?? currentDoc.id}
  >
    <Content />
  </DocsLayout>
</BaseLayout>
